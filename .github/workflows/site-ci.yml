name: Site CI

on:
  push:
    branches: [main, master, natalie]
  pull_request:

jobs:
  link-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Lychee link check
        uses: lycheeverse/lychee-action@v1
        with:
          args: --no-progress --verbose --exclude-mail '*.html' '*.md'
          fail: true

  html-validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: HTML5 Validator
        uses: Cyb3r-Jak3/html5validator-action@v7.2.0
        with:
          root: .
          css: true

  accessibility:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install pa11y-ci
        run: npm install -g pa11y-ci
      
      - name: Serve site
        run: |
          python3 -m http.server 8000 &
          sleep 2
      
      - name: Run accessibility tests
        run: |
          pa11y-ci --sitemap http://localhost:8000/ || echo "Accessibility issues found (non-blocking)"

  # Firefox tests are ONLY run locally on self-hosted runner
  firefox-tests-local-only:
    if: false  # Explicitly disabled in CI - run locally with run_firefox_local.sh
    runs-on: self-hosted
    steps:
      - name: Placeholder
        run: echo "Firefox tests run locally only"
